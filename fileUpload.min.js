/**
 * fileUpload plugin for jQuery
 * WTFPL
 */
(function(b){function a(d,e){var c=this;c.id=null;c.input=null;c.files=null;c.onChange=typeof e.change==="function"?e.change:function(){};c.dragEnterClassName="dragEnter";c.acceptedTypes="";c.dragNdropEnabled=function(){var f=document.createElement("div");return(("draggable" in f)||("ondragstart" in f&&"ondrop" in f))&&"FormData" in window&&"FileReader" in window};c.init=function(){var h=Math.floor(Math.random()*9999999999999)+1;c.id="FU_"+h;var g=b(d).prop("name");b(d).removeAttr("name");if(undefined!==e.dragEnterClass){c.dragEnterClassName=e.dragEnterClass}if(undefined!==e.dragArea){c.dragArea(e.dragArea)}var f=(typeof e.multi!=="undefined"&&e.multi)?"multiple":"";c.acceptedTypes=(typeof e.accept!=="undefined"&&e.accept)?e.accept:"";var i=b('<input type="file" name="'+g+'" id="'+c.id+'" accept="'+c.acceptedTypes+'" style="opacity:0; position:absolute;" '+f+"/>");c.input=i[0];b(c.input).insertAfter(d);c.setHandlers()};c.clearFiles=function(){if(c.input.value){try{c.input.value=""}catch(i){}if(c.input.value){var h=document.createElement("form"),f=c.input.parentNode,g=c.input.nextSibling;h.appendChild(c.input);h.reset();f.insertBefore(c.input,g)}}};c.setHandlers=function(){b(d).unbind("click").click(function(f){f.preventDefault();c.input.click()});b(c.input).unbind("change").change(function(g){if(!c.files){c.files=[]}for(var f=0;f<g.target.files.length;f++){c.files.push(g.target.files[f])}if(!c.files.length){c.files=null}c.onChange()})};c.getFiles=function(){return c.files};c.getFileText=function(g){if(window.File&&window.FileReader&&window.FileList&&window.Blob){for(var h=0;h<c.files.length;h++){var k=c.files[h];if(!k){continue}var j=new FileReader;j.onload=function(f){g(f.target.result)};j.readAsText(k)}}else{return false}return true};c.getDataURI=function(g){if(window.File&&window.FileReader&&window.FileList&&window.Blob){for(var h=0;h<c.files.length;h++){var k=c.files[h];if(!k){continue}var j=new FileReader;j.onload=function(f){g(f.target.result)};j.readAsDataURL(k)}}else{return false}return true};c.dragEnterClass=function(f){c.dragEnterClassName=f};c.dragArea=function(f){if(!c.dragNdropEnabled){return false}b(f).on("drag dragstart dragend dragover dragenter dragleave drop",function(g){g.preventDefault();g.stopPropagation()}).on("dragover dragenter",function(){b(f).addClass(c.dragEnterClassName)}).on("dragleave dragend drop",function(){b(f).removeClass(c.dragEnterClassName)}).on("drop",function(j){var h=j.originalEvent.dataTransfer.files;if(!c.files){c.files=[]}for(var g=0;g<h.length;g++){if(c.acceptedTypes===""||c.acceptedTypes.indexOf(h[g].type)>-1){c.files.push(h[g])}}if(!c.files.length){c.files=null}c.onChange()})};c.init()}b.fn.fileUpload=function(d,c){if(this.length===1&&typeof d==="string"&&b(this[0]).data("fuInstance")!=="undefined"){return b(this).data("fuInstance")[d](c)}return this.each(function(){params=typeof d==="object"?d:{};if(typeof b(this).data("fuInstance")==="undefined"){b(this).data("fuInstance",new a(this,params))}})}})(jQuery);